FROM node:10

WORKDIR /app

COPY ./development/scripts/wait-for.sh /usr/local/bin

# Install lerna
RUN npm i lerna -g --loglevel notice

COPY package-lock.json .
COPY package.json .
COPY lerna.json .
COPY ./scripts ./scripts
RUN npm install --loglevel notice --unsafe-perm
RUN lerna run build

WORKDIR /app/origin-discovery

CMD wait-for.sh -t 0 -q origin-js:8080 -- node src/apollo/app.js
